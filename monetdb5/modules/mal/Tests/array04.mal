# tiling operations over fixed arrays

#create array v(i int dimension[0:1:4], payload:int)
v:= array.series(0,1,6,1,1);
vv:= array.series(0,1,6,1,1);
io.print(v,vv);

#select sum(V) from V group by V[0:1:2]
template:= array.series(0@0,1@0,2@0,1,1);
io.print(template);

g:= array.tiles(vv,template);
io.print(g);

gs:= array.sum(vv,template);
io.print(gs);


#create array M(x int dimension[0:1:4], y int dimension[0:1:4], int default 1);
mx:= array.series(0,1,4,4,1);
my:= array.series(0,1,4,1,4);
mv:= array.series(0,1,16,1,1);
io.print(mx,my,mv);

#select sum(M) from M group by M[0:1:2][0:1:2]
t0:= array.series(0,1,2,2,1);
t1:= array.series(0,1,2,1,2);
io.print(t0,t1);

template:= array.map(mx,my,t0,t1);
io.print(template);

g:= array.tiles(mv,template);
io.print(g);

gs:= array.sum(mv,template);
io.print(gs);

# first create the larger array N[-1:1:5][-1:1:5]
nx:= array.series(-1,1,5,6,1);
ny:= array.series(-1,1,5,1,6);
nv:= array.filler(nx,nil:int);
io.print(nx,ny,nv);

#derive the mapping from cell id in N into M
map:= array.embed(nx,ny,mx,my);
io.print(map);
rv:= array.replace(nv,map,mv);

#now produce the tiled sum over the enlarged one
template:= array.map(nx,ny,t0,t1);
io.print(template);
gs:= array.sum(nv,template);
io.print(gs);
